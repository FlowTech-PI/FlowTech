<!DOCTYPE html>
<html lang="pt-br">

<!-- Apesar de estar como o nome de "Tela de Login", essa página simula um login e cadastro sem conexão a um bando de dados, por isso
        foi necessário manter na mesma página HTML o login, cadastro e "esqueci a senha" -->

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlowTech | Login & Cadastro</title>

    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="header1">
        <div class="container1">
    
            <h1 class="titulo1">FLOWTECH</h1>
        
          <ul class="navbar1">
              <li> <a href="../index/index.html">Início</a></li>
              <li>|</li>
              <li> <a href="../index/index.html#sobnos">Quem somos?</a></li>
              <li>|</li>
              <li> <a href="../index/index.html#contato">Contato</a></li>
              <li>|</li>
              <li> <a href="../Simulador_Financeiro/simulador.html">Simulador Financeiro</a></li>   
          </ul>
        </div>
      </div>

    <div id="telaCadastro" class="telaCadastro">
            <div class="container">
                <h1>Cadastro</h1>


                <div class="inputs_cad"> 
                <div class="divcaixatexto"> 
                    
                    <div class="caixatexto">
                        <label for="nome"></label>
                        <input placeholder="Nome" type="text" id="nome_input" name="nome" class="bloco1" required>

                        <label for="cpf"></label>
                        <input placeholder="CPF (apenas números)" type="text" id="input_cpf" name="cpf" class="bloco1" required>

                        <label for="email"></label>
                        <input placeholder="E-mail" type="email" id="email_input" name="email" class="bloco1" required>

                        <label for="senha"></label>
                        <input placeholder="Senha" type="password" id="senha_input" name="senha" class="bloco1" required>
                    </div>
                
                </div>

                <div class="divcaixatexto2">
                   
                    <div class="caixatexto">

                        <label for="nascimento"></label>
                        <input placeholder="Nascimento" type="text" id="input_nascimento" name="nascimento" class="bloco2" required>

                        <label for="telefone"></label>
                        <input placeholder="Telefone" type="tel" id="input_telefone" name="telefone" class="bloco2" required>

                        <label for="niveldeacesso"></label>
                        <select name="niveldeacesso" id="niveldeacesso" class="bloco2"  required>
                            <option value="" selected hidden>Nível de Acesso</option>
                            <option value="Proprietário">Proprietário</option>
                            <option value="Gerente">Gerente</option>
                            <option value="Funcionário">Funcionário</option>
                        </select>
                        
                    </div>
                </div>
            </div>


            <div class="buttons"> 
                <button class="enviar" onclick="cadastrar()">Cadastrar</button>
                
            </div> 


            <div class="links">
                <a onclick="trocarLogin()">Já tenho Conta</a>
            </div>
                         
            </div>  
            
    </center>
    </div>



    <main id="telaLogin" class="telaLogin" style="display: none;">
        <div class="container">
            <div class="form">
                <h2 class="titulo">Login</h2>
                
                <input type="text" id="input_login" placeholder="Login">
                <input type="password" id="input_senha" placeholder="Senha">

                <button onclick="autenticar()" class="enviaron">Entrar</button>

                <div class="links" id="esqueci_senha">
                    <a onclick="trocarSenha()">Esqueci minha Senha</a>
                    <span> | </span>
                    <a onclick="trocarCadastro()">Criar Conta</a>
                </div>

                <div class="links" id="termos">
                    <a href="../privacidade/privacidade.html">Política de Privacidade</a>
                    <span> | </span>
                    <a href="../termo_uso/uso.html">Termos de Uso</a>
                </div>
            </div>
        </div>
    </main>

    <main id="telaSenha" class="telaSenha" style="display: none;">
        <div class="container">
            <div class="form">
                <h2 class="titulo">Esqueci Minha Senha</h2>
                
                <input type="text" id="input_Remail" placeholder="Email">
                <input type="password" id="input_Rcdg" placeholder="Código">

                <input type="password" id="input_NovaSenha" class="NovaSenha" placeholder="Inserir Nova Senha" style="display: none;">

                <div class="bts">
                <button onclick="gerar()" class="cdg" id="bt_gerar">Enviar código por email</button>
                <button onclick="redefinir()" id="bt_redefinir_senha">Redefinir Senha</button>
                <button onclick="salvar()" id="bt_salvar_senha" style="display: none;">Salvar Senha</button>
                </div>

                


                <div class="links" id="esqueci_senha">
                    <a onclick="trocarLogin()">Voltar</a>
                    <span> | </span>
                    <a onclick="trocarCadastro()">Criar Conta</a>
                </div>

                <div class="links" id="termos">
                    <a href="#">Política de Privacidade</a>
                    <span> | </span>
                    <a href="#">Termos de Serviço</a>
                </div>

            </div>
        </div>
    </main>




</body>

</html>

<script>
  function cadastrar() {
    

    //Recupere o valor da nova input pelo nome do id
    // Agora vá para o método fetch logo abaixo
    var nomeVar = nome_input.value;
    var emailVar = email_input.value;
    var senhaVar = senha_input.value;

    var cpfVar = input_cpf.value;
    var nascVar = input_nascimento.value;
    var telVar = input_telefone.value;
    var nivelVar = niveldeacesso.value;



    
    
   

    // Enviando o valor da nova input
    fetch("/usuarios/cadastrar", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        // crie um atributo que recebe o valor recuperado aqui
        // Agora vá para o arquivo routes/usuario.js
        nomeServer: nomeVar,
        emailServer: emailVar,
        senhaServer: senhaVar,
        cpfServer: cpfVar,
        telefoneServer: telVar,
        nascimentoServer: nascVar,
        nivelacessoServer: nivelVar,
      }),
    })
      .then(function (resposta) {
        console.log("resposta: ", resposta);

        if (resposta.ok) {
          cardErro.style.display = "block";

          mensagem_erro.innerHTML =
            "Cadastro realizado com sucesso! Redirecionando para tela de Login...";

          setTimeout(() => {
            window.location = "login.html";
          }, "2000");

        


         
        } else {
          throw "Houve um erro ao tentar realizar o cadastro!";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
        
      });

    return false;
  }

  function listar() {
    fetch("/empresas/listar", {
      method: "GET",
    })
      .then(function (resposta) {
        resposta.json().then((empresas) => {
          empresas.forEach((empresa) => {
            listaEmpresas.innerHTML += `<option value='${empresa.id}'>${empresa.cnpj}</option>`;
          });
        });
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });
  }

  function sumirMensagem() {
    cardErro.style.display = "none";
  }
</script>