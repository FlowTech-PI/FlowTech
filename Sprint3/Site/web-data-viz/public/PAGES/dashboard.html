<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FlowTech | Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
  <link rel="stylesheet" href="../CSS/styleDashboard.css">
</head>

<body id="Dashboard">
  <div class="header">
    <div id="NavDashboard" class="container">

      <div class="menu">
        <span id="menuH" class="material-symbols-outlined" onclick="clickMenu()">MENU</span>
        <h1 class="titulo">FLOWTECH</h1>
      </div>

      <ul class="navbar">
        <li><a href="../index.html">In√≠cio</a></li>
        <li>|</li>
        <li> <a href="perfil.html">Perfil</a></li>
        <li>|</li>
        <li><a href="simulador.html">Simulador Financeiro</a></li>
        <li>|</li>
        <li><u>Dashboard</u></li>
        <li>|</li>
        <li><a href="graficos.html">Gr√°ficos</a></li>
        <li>|</li>
        <li><a href="heatmap/heatmap.html">Heatmap</a></li>
        <li>|</li>
        <li><a href="../ajuda.html">Ajuda</a></li>
      </ul>
    </div>
  </div>

  <div class="main_conteudo">
    <div id="itens-laterais">
      <ul class="listaItens">
        <div id="fp" class="fotoPerfil">
          <a href="perfil.html"><img src="../CSS/IMG/perfil.png" alt="foto de perfil"></a>
        </div>
        <li><a href="simulador.html">üñ• Simulador Financeiro</a></li>
        <li><a href="graficos.html">üìä Gr√°ficos</a></li>
        <li><a href="dashboard.html">üñ•Ô∏è Dashboard</a></li>
        <li><a href="heatmap/heatmap.html">üó∫Ô∏è HeatMap </a></li>
        <li><a href="ajuda.html">üìû Ajuda </a></li>
        <li><a href="../index.html">Sair</a></li>
      </ul>
    </div>

    <div class="conteudo">
      <div class="box-title">
        <h2>Dashboard</h2>
        <h6>FLOWTECH</h6>
      </div>

        <select id="select_freq" onchange="atualizar(1)">
          <option value="dia">√öltimas 24 horas</option>
          <option value="semana">Na Semana</option>
          <option value="mes">No M√™s</option>
        </select>
        
        <h1 style="color: #1D314D;">3 ESTA√á√ïES COM MAIOR FLUXO</h1>

      <!------------------------- Dados da Dashboard -------------------------------------->
      <div class="container">
        <div class="dataGroup">

          <div class="dataBox" id='E'>
            <div class="textBox">
              <span id="estacao1">PINHEIROS</span>
            </div>
            <div class="data">
              <span id="data_BoxE">0 Capturas</span>
            </div>
          </div>

          <div class="dataBox" id='M'>
            <div class="textBox">
              <span id="estacao2">HIGIEN√ìPOLIS</span>
            </div>
            <div class="data">
              <span id="data_BoxM">0 Capturas</span>
            </div>
          </div>

          <div class="dataBox" id='D'>
            <div class="textBox">
              <span id="estacao3">PAULISTA</span>
            </div>
            <div class="data">
              <span id="data_BoxD">0 Capturas</span>
            </div>
          </div>

        </div>
      </div>

      <!------------------------------- legenda -------------------------------------------->
      <div class="legenda">
        <div class="bloco">
          <div class="group">
            <div class="quadrado" id="quad1" style="background-color: #FF3131;"></div>
            <div class="quadrado" id="quad2" style="background-color: #FF914D;"></div>
            <div class="quadrado" id="quad3" style="background-color: #FFDE59;"></div>
          </div>
          <div class="group">
            <p id="parametro1"> > 3.000 </p>
            <p id="parametro2"> > 5.000 </p>
            <p id="parametro3"> > 8.000 </p>
          </div>
        </div>

        <div class="bloco">
          <div class="group">
            <div class="quadrado" id="quad4" style="background-color: #C2E806;"></div>
            <div class="quadrado" id="quad5" style="background-color: #4EE888;"></div>
            <div class="quadrado" id="quad6" style="background-color: #41BB4D;"></div>
          </div>
          <div class="group">
            <p id="parametro4"> > 10.000 </p>
            <p id="parametro5"> > 15.000 </p>
            <p id="parametro6"> > 20.000 </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>

</html>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  // atualizar();
  let aux = 1

  function clickMenu() {
    var itensLaterais = document.getElementById('itens-laterais');
    if (itensLaterais.style.display === 'block') {
      itensLaterais.style.display = 'none';
    } else {
      itensLaterais.style.display = 'block';
    }
  }

  function atualizar(params) {
    var freq = select_freq.value;

    if (freq == "dia") {
      data_BoxE.innerHTML = `${Number(array_dados[0].dadosPorDia.PinheirosDia.cont) + 22678} <br> Capturas`;
      data_BoxM.innerHTML = `${Number(array_dados[0].dadosPorDia.PinheirosDia.cont) + 19990} <br> Capturas`;
      data_BoxD.innerHTML = `${Number(array_dados[0].dadosPorDia.PinheirosDia.cont) + 1200} <br> Capturas`;
      estacao1.innerHTML = 'PINHEIROS';
      estacao2.innerHTML = 'HIGIEN√ìPOLIS';
      estacao3.innerHTML = 'PAULISTA';
        E.style.backgroundColor = '#41BB4D' 
        
      M.style.backgroundColor = '#41BB4D';
      D.style.backgroundColor = '#FF3131';

      // LEGENDA GR√ÅFICO
      parametro6.innerHTML = 'Maior que 20.000';
      parametro5.innerHTML = '15.000 √† 19.999';
      parametro4.innerHTML = '10.000 √† 14.999';
      parametro3.innerHTML = '8.000 √† 9.999';
      parametro2.innerHTML = '5.000 √† 7.999';
      parametro1.innerHTML = '0 √† 4.999';

      if( params == 1)piscarD();

    } else if (freq == "semana") {
      E.style.backgroundColor = '#41BB4D';
      D.style.backgroundColor = '#C2E806';
      M.style.backgroundColor = '#4EE888'; 
      data_BoxE.innerHTML = `${Number(array_dados[1].dadosPorSemana.PinheirosSemana.cont) + 200000} <br> Capturas`;
      data_BoxM.innerHTML = `${Number(array_dados[1].dadosPorSemana.PinheirosSemana.cont) + 129876} <br> Capturas`;
      data_BoxD.innerHTML = `${Number(array_dados[1].dadosPorSemana.PinheirosSemana.cont) + 87990} <br> Capturas`;    
      estacao1.innerHTML = 'PAULISTA';
      estacao2.innerHTML = 'VILA S√îNIA';
      estacao3.innerHTML = 'PINHEIROS';
      parametro6.innerHTML = ' Maior que 150.000';
      parametro5.innerHTML = ' 100.000 √† 149.999 ';
      parametro4.innerHTML = ' 65.000 √† 99.999 ';
      parametro3.innerHTML = ' 40.000 √† 64.999 ';
      parametro2.innerHTML = ' 20.000 √† 39.999 ';
      parametro1.innerHTML = '0 √† 19.999';

      if( params == 1)piscarS()

      // OKAY
    } else if (freq == "mes") {
      
      
      data_BoxE.innerHTML = `${Number(array_dados[2].dadosPorMes.PinheirosMes.cont) + 650000} <br> Capturas`;
      data_BoxM.innerHTML = `${Number(array_dados[2].dadosPorMes.PinheirosMes.cont) + 489987} <br> Capturas`;
      data_BoxD.innerHTML = `${Number(array_dados[2].dadosPorMes.PinheirosMes.cont) + 320989} <br> Capturas`;
     
      E.style.backgroundColor = '#41BB4D';
      M.style.backgroundColor = '#C2E806';
      D.style.backgroundColor = '#FFDE59';
      estacao1.innerHTML = 'LUZ';
      estacao2.innerHTML = 'BUTANT√É';
      estacao3.innerHTML = 'OSCAR FREIRE';
      parametro6.innerHTML = 'Maior que 550.000'
      parametro5.innerHTML = '350.000 √† 549.999'
      parametro4.innerHTML = '250.000 √† 349.999'
      parametro3.innerHTML = '150.000 √† 249.999'
      parametro2.innerHTML = '100.000 √† 149.999'
      parametro1.innerHTML = '0 √† 99.999'

      if( params == 1)piscarM()
    }
  }

  
  function piscarD() {

    var delay = 500;
    for (var cont = 0; cont < 5; cont++) {
      var picoD1 = setTimeout(function () {
        E.style.backgroundColor = '#209e2d';
        data_BoxE.style.color = '#FFF';
        M.style.backgroundColor = '#209e2d';
        data_BoxM.style.color = '#FFF';
      }, delay);

      delay += 500;

      var piscoD2 = setTimeout(function () {
        E.style.backgroundColor = '#41BB4D';
        data_BoxE.style.color = '#1D314D';
        M.style.backgroundColor = '#41BB4D';
        data_BoxM.style.color = '#1D314D';

      }, delay);
      delay += 500;
    }

    return false

  }

  function piscarS() {
    // clearTimeout(piscoD2)
    
    var delay = 500;

    for (var cont = 0; cont < 5; cont++) {
      setTimeout(function () {
        E.style.backgroundColor = '#209e2d';
        data_BoxE.style.color = '#FFF';
        
      }, delay);

      delay += 500;

      setTimeout(function () {
        E.style.backgroundColor = '#41BB4D';
        data_BoxE.style.color = '#1D314D';

      }, delay);
      delay += 500;
    }
  }

  function piscarM() {
    var delay = 500;
    for (var cont = 0; cont < 5; cont++) {
      setTimeout(function () {
        E.style.backgroundColor = '#209e2d';
        data_BoxE.style.color = '#FFF';
      }, delay);

      delay += 500;

      setTimeout(function () {
        E.style.backgroundColor = '#41BB4D';
        data_BoxE.style.color = '#1D314D';
      }, delay);
      delay += 500;
    }
  }
let array_dados =[];
const array_dia =[];
const array_semana =[];
const array_mes =[];

obterDados(1);
  function obterDados(param){
    
    if (param == 1){
      console.log('Atualizou')
    fetch(`/avisos/obterDadosDia`)
              .then(function (resposta){
              if (resposta.ok) {
              resposta.json().then(resultadoDadosDia =>{
                console.log(resultadoDadosDia)
                console.log(JSON.stringify(resultadoDadosDia));
                array_dados[0] = ({dadosPorDia : resultadoDadosDia})
                // array_dia.push()
                // console.log('dado1:', dado_1, 'dado2:', dado_2, 'dado3:', dado_3, 'dado4:', dado_4)
              })
        }
      },
    )
    setTimeout(()=>obterDados(2), 50)  
    atualizar(aux)
    aux = 2

    } else if (param == 2){
    fetch(`/avisos/obterDadosSemana`)
              .then(function (resposta){
              if (resposta.ok) {
              resposta.json().then(resultadoDadosSemana =>{
                console.log(resultadoDadosSemana)
                console.log(JSON.stringify(resultadoDadosSemana));
                array_dados[1] = ({dadosPorSemana : resultadoDadosSemana})
                // console.log('dado1:', dado_1, 'dado2:', dado_2, 'dado3:', dado_3, 'dado4:', dado_4)
              })
        }
      },
    )
    atualizar(2)
    setTimeout(()=>obterDados(3), 100)  
  } else if (param == 3){
    fetch(`/avisos/obterDadosMes`)
              .then(function (resposta){
              if (resposta.ok) {
              resposta.json().then(resultadoDadosMes =>{
                console.log(resultadoDadosMes)
                console.log(JSON.stringify(resultadoDadosMes));
                array_dados[2] = ({dadosPorMes : resultadoDadosMes})
                // console.log('dado1:', dado_1, 'dado2:', dado_2, 'dado3:', dado_3, 'dado4:', dado_4)
              })
        }
      },
    )
    atualizar(2)
    setTimeout(()=>obterDados(1), 800)
  }
  }
  
</script>